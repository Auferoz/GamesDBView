---
import Layout from "@layouts/Layout.astro";
import CardGame from "@components/CardGame.astro";
import { getGamebyId } from '../../../../services/services'

export const prerender = false

const { id } = Astro.params

let game: any

if (id) {
    game = await getGamebyId({ id })
}

const imageSrc = `https://images.igdb.com/igdb/image/upload/t_1080p/${game.poster}.webp`;

const respRawg = await fetch(`https://api.rawg.io/api/games?key=3dc1bd459a81415caebcb7eae0411687&search=${game.title}`);
const dataRawg = await respRawg.json();
const dataZero = dataRawg.results[0];


---

<Layout title=`${game.title} | Game`>
    <section class="flex flex-row gap-4">
        
        <article class="w-6/12 xl:w-4/12">
            <a onclick="history.back()">
                <img 
                transition:name={`${game.title}-image`}
                src={imageSrc} 
                alt={game.title}
                class="w-full rounded-lg border">
            </a>
        </article>

        <aside class="w-6/12 xl:w-9/12">
            <p class="text-lg xl:text-4xl font-light truncate">
                {game.title}
            </p>
            <p class="text-md xl:text-xl mb-2 font-semibold italic">
                {game.released}
            </p>
            <p class="text-md xl:text-2xl mb-0 font-light">
                <span class="font-medium">Companie:</span>
                {game.companie}
            </p>
            <p class="text-md xl:text-2xl mb-0 font-light">
                <span class="font-medium">State:</span>
                {game.state}
            </p>
            <p class="text-md xl:text-2xl mb-0 font-light">
                <span class="font-medium">Hours:</span>
                {game.hours}Hrs
            </p>
            <p class="text-md xl:text-2xl mb-0 font-light">
                <span class="font-medium">Date:</span>
                {game.dateStart} - {game.dateEnd}
            </p>
            <p class="text-md xl:text-2xl mb-0 font-light">
                <span class="font-medium">Achievements:</span>
                {game.achievementsObtained} / {game.achievementsTotals}
            </p>
            <p class="text-md xl:text-2xl mb-0 font-light">
                <span class="font-medium">Platform:</span>
                {game.platform}
            </p>
        </aside>

    </section>

    <hr class="my-6">

    <section class="flex flex-col gap-4 mt-4">
        <p class="text-xl font-semibold">
            Rating: <span class="text-lg font-light">{dataZero.rating} / 5</span>
        </p>
        
        <p class="text-xl font-semibold">
            Genres:
            {dataZero.genres.map((genres: { name: string; }) => (
                <span class="text-lg pl-2 font-light">{genres.name},</span>
            ))}
        </p>
    </section>

    <hr class="my-6">

    <section class="flex flex-col gap-4 mt-4">
        <h3 class="text-2xl xl:text-4xl font-normal">
            Screenshot
        </h3>
        <div class="flex flex-col gap-4">
            {dataZero.short_screenshots.map((screenshot: { image: string | null | undefined; id: any; }) => (
                <img class="border rounded-lg" src={screenshot.image} alt={`Screenshot ${screenshot.id}`} />
            ))}
        </div>
    </section>
</Layout>